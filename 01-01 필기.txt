문제 28. 사원 테이블에서 월급의 순위가 1등인 사원의 이름과 월급과 순위를 출력하시오 !

	hive> select *
	        from  (  select  ename, sal,         
	                    rank()  over (order by sal desc) rnk
	                   from  emp 
	               )  aaa
	        where rnk = 1; 
	
	※ hive 에서는 from 절의 서브쿼리에 alias 를 사용해야한다. 




문제 29.  아래의 오라클 SQL 을 Hive 로 구현하시오 !

	SQL>  select  deptno, sum(sal)
	        from  emp
	        group  by  rollup(deptno);
	
	hive> select  deptno, sum(sal)
	        from  emp
	        group  by  deptno  with  rollup;
	
	hive> select  *
	        from   (  select  deptno, sum(sal)
	                     from emp
	                     group by deptno
	                    union  all
	                  select null  as deptno, sum(sal)
	                     from emp )  aaa;


	※ union all 과 같은 집합 연산자를 hive 에서 사용할때는
	   반드시 from 절의 서브쿼리에 사용해야한다.

	hive> select  deptno, sum(sal)
	        from  emp
	        group  by  deptno  with  rollup
	        order  by  deptno  desc; 





문제 30. 아래의 오라클 SQL 을 hive 에서 구현하시오 !

	SQL>  select  deptno, job, sum(sal)
	        from  emp
	        group  by  rollup(deptno,job);
	
	
	hive> select  deptno, job, sum(sal)
	        from  emp
	        group  by  deptno, job  with  rollup;





문제 31. 아래의 오라클 SQL 을 Hive 로 구현하시오 !  

	SQL>  select  deptno, sum(sal)
	        from  emp
	        group  by  grouping  sets( deptno, () );  
	
	hive>  select  deptno, sum(sal)
	          from  emp
	          group  by  deptno  gruoping  sets( deptno, () ); 
	
	hive>  select  deptno, sum(sal)
	          from  emp
	          group  by  deptno  grouping  sets( (), deptno ); 





문제 32.  아래의 오라클 SQL 을 Hive 로 구현하시오 !

	SQL>  select  deptno, job, sum(sal)
	        from  emp
	        group  by  grouping  sets( (deptno), (job), () );
	
	hive> select deptno, job, sum(sal)
	        from emp
	        group by deptno, job grouping sets(deptno, job, () );






문제 33. 사원 테이블의 직업의 종류가 몇가지인지 출력하시오 ! 

	hive> select  count( distinct  job)  from  emp;




문제 34. 오라클의 with 절의 hive 에서도 가능하지 확인하시오 !

	SQL> with  q1  as  ( select  job, sum(sal)  sumsal
	                       from  emp
	                       group  by  job )
	     select  job, sumsal
	        from  q1;
	
	hive>   with  q1   ( select  job, sum(sal)  sumsal
	                       from  emp
	                       group  by  job )
	         select  job, sumsal
	           from  q1;
	
	※ hive 에서는  update, delete 는 지원 안함 .
	   insert 는 append 는 가능하다.





문제 35. scott 의 월급을 9000 으로 변경하시오 !

	hive>  update  emp
	          set  sal = 9000
	          where  ename='SCOTT'; 





문제 36. 사원 테이블을 전부 삭제 하시오 !  (delete) 

	  delete  from   emp; 





문제 37. emp 테이블을 emp_backup 으로 생성하시오 !

	hive> create  table  emp_backup
	      as
	         select  * from  emp; 
	
	hive> select * from  emp_backup; 





문제 38. emp 테이블의 데이터를 emp_backup 에 insert 하시오

	hive>  insert  into  table  emp_backup
	       select *
	        from  emp; 
	
	hive> select count(*)  from  emp_backup;
	
	28





문제 39. emp_backup 의 내용을 emp 테이블의 내용으로 overwrite 
        하시오 !

	hive> insert overwrite  table  emp_backup
	      select *
	       from  emp;
	
	hive> select count(*) from emp_backup;
	
	14




    
  * 하둡 목차          

   1. 하둡을 배워야하는 이유 
   2. 하둡 설치
   3. 하둡 분산 파일 시스템 명령어
   4. Hive 
   5. Tajo
   6. pig
   7. mongo db
   8. mySQL
   9. sqoop 으로 오라클과 연동 
  10. 멥리듀스를 java 로 수행하기 





■ Tajo 설치 방법 정리  

	0. /media/sf_Share 밑에 있는 타조 설치 파일을 /home/oracle 밑으로 복사한다.

		# cd  /media/sf_Share

		# cp tajo-0.11.1.tar.gz  /home/oracle/


	1. 타조 설치파일의 소유자를 oracle 로 변경한다.

		# chown -R  oracle:oinstall  tajo-0.11.1.tar.gz


	2. oracle 유져에서 타조 설치 파일의 압축을 푼다.

		$ tar -xvzf tajo-0.11.1.tar.gz


	3. tajo 디렉토리가 생겼는지 확인한다. 

		$ ls -ld tajo*


	4. tajo 홈디렉토리의 이름을 tajo 로 변경한다.

		$ mv tajo-0.11.1-desktop-r1 tajo



	5. tajo 디렉토리로 들어가서 conf 디렉토리로 간다.

		$ cd  tajo


	6. tajo 환경설정을 한다. 

		$ cd tajo
		
		$ ls -ld  bin
		
		$ sh bin/configure.sh
		
		Enter JAVA_HOME [default: /u01/app/java/jdk1.7.0_60]

		그냥 엔터 
		
		Would you like advanced configure? [y/N]  N
		                                          ↑
		                                      N이라고 하고 엔터 

	7. tajo 를 시작 시킨다.

		$ sh bin/startup.sh


	8. tajo 로 접속을 한다.

		[orcl:tajo]$ sh bin/tsql


	9. orcl 라는 데이터 베이스를 만들고 orcl 데이터베이스에 접속한다. 

		default> create database orcl;
	
		default> \c orcl;
	
		You are now connected to database "orcl" as user "oracle".


	10. emp 테이블을 생성한다.

		CREATE EXTERNAL TABLE emp (
		 empno INT ,
		 ename text ,
		 job TEXT ,
		 mgrno INT,
		 hiredate text,
		 sal INT,
		 comm INT,
		 deptno int 
		) USING CSV WITH ('text.delimiter'=',') LOCATION 'file:///home/oracle/emp2.csv';


	11. emp 테이블을 조회한다.

		orcl> select * from emp;




문제 40. 월급이 3000 인 사원들의 이름과 월급을 출력하시오 ! 



문제 41. (점심시간 문제)  월급이 1000 에서 3000 사이인 사원들의 이름과 월급을 출력하시오 ! 



문제 42.  이름의 첫글자가 S 로 시작하는 사원들의 이름과 월급을 출력하시오 ! 

	tajo>  select ename
	        from emp
	       where ename like 'S%';



문제 43. 커미션이 null 인 사원들의 이름과 커미션을 출력하시오 !

	 select ename, comm
	  from  emp
	  where  comm is null;




문제 44. 직업, 직업별 토탈월급을 출력하시오 !

	tajo> select job, sum(sal)
	      from emp
	      group  by job;




문제 45. having 절이 지원되는지 확인하시오 !
         직업, 직업별 토탈월급을 출력하는데 직업별 토탈월급이 4000 이상인것만 출력하시오 !

	select  job, sum(sal)
	  from emp
	  group by job
	  having sum(sal) >= 4000;




문제 46. select 문의 6가지절이 다 지원되는지 확인하시오 !
         직업, 직업별 토탈월급을 출력하는데 직업이 SALESMAN 인 사원들은 제외하고 출력하고 직업별 토탈월급이 
	 4000 이상인 것만 출력하고 직업별 토탈월급이 높은것부터 출력하시오 !

	 select  job, sum(sal)
	   from  emp 
	   where  job !='SALESMAN'
	   group  by  job
	   having  sum(sal) >= 4000
	   order by  sum(sal) desc; 




문제 47.부서번호, 부서번호별 토탈월급을 출력하는데 가로로 출력하시오 !

	SQL> select sum( decode(deptno,10,sal) ) "10",
	               sum( decode(deptno,20,sal) ) "20",
	               sum( decode(detpno,30,sal) ) "30"
	         from  emp;
	
	tajo>  select  sum(case when deptno=10 then sal end) dept10,
	               sum(case when deptno=20 then sal end) dept20,
	               sum(case when deptno=30 then sal end) dept30
	         from emp;




문제 48.  dept2.csv 로 dept 테이블을 생성하시오 !
          ( emp 테이블 생성했던 스크립트 가져와서 수정하세요)

	CREATE EXTERNAL TABLE  dept (
	 deptno INT ,
	 dname text ,
	 loc TEXT 
	) USING CSV WITH ('text.delimiter'=',') LOCATION 'file:///home/oracle/dept2.csv';




문제 49.  이름과 부서위치를 출력하시오 ! 

	 select  e.ename, d.loc
	   from  emp  e, dept  d
	   where  e.deptno = d.deptno ;




문제 50. 이름과 부서위치를 출력하는데 right outer join 을 써서 출력하시오 ! 

	 select  e.ename, d.loc
	  from  emp  e  right  outer  join  dept  d
	  on  ( e.deptno = d.deptno );




문제 51. 타조에서 full outer join 도 지원되는지 확인하시오 ! 

	 select  e.ename, d.loc
	  from  emp  e  full  outer  join  dept  d
	  on  ( e.deptno = d.deptno );




문제 52. 타조에서는 rollup 이 지원되지는 않지만 union all 은 지원되므로 아래의 SQL 을 union all 로 
	 구현하시오 !

	SQL> select  deptno, sum(sal)
	       from  emp
	       group  by  rollup(deptno);
	
	tajo> select  deptno, sum(sal)
	        from  emp
	        group  by  deptno
	      union  all
	      select  0  as deptno, sum(sal)
	        from emp; 




문제 53. 이름과 월급과 순위를 출력하는데 순위를 월급이 높은 사원 순으로 순위를 부여하시오 !

	tajo> select  ename, sal, rank()  over (order by sal desc) rnk
	        from  emp; 




문제 54. 사원번호, 이름과 월급과 월급의 누적치를 출력하시오 ! 

	select  empno, ename, sal, 
	               sum(sal) over (order by sal asc rows
	                              between unbounded preceding
	                              and  current  row)  sumsal
	  from  emp; 
	
	 ※ 타조는 누적 데이터 출력을 지원 안함 




문제 55. lead 와 lag 데이터 분석함수가 지원이 되는지 확인하시오!

	select  ename, sal, 
	        lead(sal,1) over ( order by  sal  asc)  lead_sal,
	         lag(sal,1) over ( order by  sal  asc)  lag_sal
	   from  emp;




문제 56. 우리반 테이블을 타조에 올려서 테이블로 생성하시오!

	CREATE EXTERNAL TABLE  emp8 (
	ename   	text,
	age	   int,
	brith	  text,
	major	  text,
	email	   text,
	telecom    text,	 
	address     text 
	) USING CSV WITH ('text.delimiter'=',') LOCATION 'file:///home/oracle/emp8.csv';
	
	
	ename	
	age	
	brith	
	major	
	email	
	teleco	 
	address







■ tajo 에서 한글 깨지지 않게 하는 방법

	$ cd  /home/oracle/tajo/tajo/conf
	
	$ vi  tajo-env.sh
	
	맨 아래에 아래의 내용을 추가 
	
	LANG="ko_KR.UTF-8"
	export LANG="ko_KR.UTF-8"
	
	$ 저장하고 나와서 다시 타조 접속




문제 57.  전공이 심리학과인 학생들이 이름과 나이와 전공을 출력하시오 !

	select ename, age, major
	     from emp8
	    where  major like '%심리%';




문제 58. 서울에서 살지 않는 학생들의 이름과 나이와 주소를 출력하시오!

	 select  ename, age, address
	    from  emp8
	   where address not like '%서울%'




문제 59. 리눅스 자동화 쉘에 아래의 내용을 추가하시오 !
        "타조로 접속하려면 6번을"  을 추가하시오 !

	$ sh total.sh 
	
	       1. 두파일의 차이를 확인하려면 1번을
	       2. 특정 파일을 검색하려면 2번을 
	       3. 찾고자하는 단어의 갯수를 검색하려면 3번을 
	       4. 오라클 데이터를 csv 로 생성하려면 4번을
	       5. emp.csv 에서 이름과 월급을 검색하려면 5번을
	       6. 타조로 접속하려면 6번을 

	답 :  $ cd
	
	      $ vi .bash_profile
	
	      export TAJO_HOME=/home/oracle/tajo/tajo
	      export PATH=$TAJO_HOME/bin:$PATH
	
	      $ . .bash_profile
	
	      $ tsql 





문제 60. 리눅스 자동화 쉘에 아래의 내용을 추가하시오 !
         "하이브로 접속하려면 7번을"  을 추가하시오 !

	$ sh total.sh 
	
	       1. 두파일의 차이를 확인하려면 1번을
	       2. 특정 파일을 검색하려면 2번을 
	       3. 찾고자하는 단어의 갯수를 검색하려면 3번을 
	       4. 오라클 데이터를 csv 로 생성하려면 4번을
	       5. emp.csv 에서 이름과 월급을 검색하려면 5번을
	       6. 타조로 접속하려면 6번을 
	       7. 하이브로 접속하려면 7번을  

문제 61. 타조를 시작시키는 명령어와 타조를 중지시키는 명령어를 자동화 스크립트에 추가하시오 ! 
	 (오늘의 마지막 문제)

	 타조 시작시키는 명령어 :  startup.sh
	 타조 중지시키는 명령어 :  stop-tajo.sh
	
	$ sh total.sh 
	
	       1. 두파일의 차이를 확인하려면 1번을
	       2. 특정 파일을 검색하려면 2번을 
	       3. 찾고자하는 단어의 갯수를 검색하려면 3번을 
	       4. 오라클 데이터를 csv 로 생성하려면 4번을
	       5. emp.csv 에서 이름과 월급을 검색하려면 5번을
	       6. 타조로 접속하려면 6번을 
	       7. 하이브로 접속하려면 7번을  
	       8. 타조를 시작시키려면 8번을
	       9. 타조를 중지시키려면 9번을 